description: |
  This example shows:
   - Specific version of the isopod.
   - this is for go application
usage:
  version: 2.1

  orbs:
    go: circleci/go@1.7.1
    ric-orb: ricardo/ric-orb@3

  #FIXME: isopod version that you want to use
  cfg-isopod-version: &cfg-isopod-version
    isopod_version: 0.29.4

  cfg-go-build-test-executor: &cfg-go-build-test-executor
    name: go/default
    tag: '1.17'

  workflows:
    version: 2
    #FIXME: replace with app name
    singlerepo-app:
      jobs:
        - ric-orb/go_build_test:
            name: build-test
            context: dev
            executor: *cfg-go-build-test-executor
        - request_branch_deploy_dev:
            type: approval
            name: request-deploy
            filters:
              branches:
                ignore:
                  - master
        - ric-orb/build_push_image:
            <<: *cfg-isopod-version
            context: dev
            name: docker
            requires:
              - request-deploy
              - build-test
        - ric-orb/deploy_job:
            <<: *cfg-isopod-version
            env: dev
            context: dev
            name: deploy-dev
            requires:
              - docker
        - ric-orb/deploy_job:
            <<: *cfg-isopod-version
            env: prod
            context: prod
            name: deploy-prod
            requires:
              - deploy-dev
