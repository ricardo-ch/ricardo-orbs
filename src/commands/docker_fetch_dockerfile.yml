description: >
  Ensures that the dockerfile is present, if not, download one for the selected template.

parameters:
  work_dir:
    type: string
    default: .
  repository_version:
    description: 'The version of the ricardo-orbs from which to get the Dockerfiles, it can be a tag or a branch.'
    type: string
    default: 'main'
  docker_template:
    description: 'Get the Dockerfile from a template, normally for a given language/version.'
    type: enum
    enum: ['none', 'java17']
    default: 'none'

steps:
  - run:
      name: Ensure or fetch Dockerfile
      working_directory: << parameters.work_dir >>
      environment:
        REPOSITORY_ROOT: https://raw.githubusercontent.com/ricardo-ch/ricardo-orbs/<< parameters.repository_version >>
        DOCKER_TEMPLATE: << parameters.docker_template >>
      command: |
        if [[ -f "./Dockerfile" ]]; then
          echo "Dockerfile already exists, skipping"
        elif [[ "$DOCKER_TEMPLATE" != "none" ]]; then
          TEMPLATE_URL="$REPOSITORY_ROOT/src/templates/docker/$DOCKER_TEMPLATE/Dockerfile"
          echo "Fetching Dockerfile for $DOCKER_TEMPLATE from $TEMPLATE_URL ..."
          wget -O ./Dockerfile "$TEMPLATE_URL"
        else
          echo "Neither a Dockerfile exists nor a template was selected, failing."
          exit 1
        fi
