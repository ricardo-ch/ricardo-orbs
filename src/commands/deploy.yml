description: >
  Deploy to a GKE cluster to given environment. Use Isopod.

parameters:
  to:
    description: 'Environment to deploy to'
    type: enum
    enum: [ dev, prod ]
    default: dev
  config:
    type: string
    default: isopod.yml
  work_dir:
    type: string
    default: .

steps:
  - auth_gke
  - run:
      working_directory: << parameters.work_dir >>
      name: Deploy to cluster
      command: isopod -f << parameters.config >> deploy --environment << parameters.to >>
