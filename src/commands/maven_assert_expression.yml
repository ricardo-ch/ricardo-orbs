description: >
  Checks that some expression evaluated from the Maven project matches with a certain pattern.
  This job will succeed if the expression contains the pattern, and fail otherwise.
  Thus it can be used to allow/block flows depending on the value of the expression.

parameters:
  expression:
    description: 'An expression to evaluate. Note that this must not include the surrounding ${...}'
    type: string
  pattern:
    description: 'The pattern to match against the expression'
    type: string
  pom_file:
    description: 'The pom file to use'
    type: string
    default: 'pom.xml'

steps:
  - run:
      name: Verify that expression contains pattern
      command: |
        RESULT=$(./mvnw help:evaluate -Dexpression=<< parameters.expression >> -q -DforceStdout -f << parameters.pom_file >>)
        echo $RESULT | grep "<< parameters.pattern >>"
