description: >
  Deploy a java app.
  Supports app-module from monorepo as well as single app from single-app-repo.
  Expects an isopod.yml file to be present in the app directory (maven module directory for monorepo app, or project root for single-app-repo).

parameters:
  appname:
    description: "Name of maven module for the app, or blank for single-app-repo"
    type: string
    default: ""
  to:
    description: "Kubernetes cluster to deploy to"
    type: enum
    enum: [ "dev", "prod"]
    default: "dev"

steps:
  # deploy an app (maven module) from monorepo
  - when:
      condition: << parameters.appname >>
      steps:
        - deploy:
            to: << parameters.to >>
            config: << parameters.appname >>/isopod.yml
            work_dir: .
  # deploy single app from single-app-repo
  - unless:
      condition: << parameters.appname >>
      steps:
        - deploy:
            to: << parameters.to >>
            config: isopod.yml
            work_dir: .
