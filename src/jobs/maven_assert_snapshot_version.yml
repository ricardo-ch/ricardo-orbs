description: >
  Checks that the Maven project (of the provided pom file) has a SNAPSHOT version, otherwise it fails.
  Typically used to force that branch builds of library modules have a -SNAPSHOT version when manually deployed.

parameters:
  pom_file:
    description: 'The pom file to use'
    type: string
    default: 'pom.xml'
  executor:
    description: 'Executor for the build (Either use existing ones: maven_docker, maven_vm or define your own)'
    type: executor
    default: 'maven_docker'
  maven_credentials:
    # NOTE that this is the context variable name, not the context variable itself (i.e. ARTIFACTORY_MAVEN_CREDENTIALS, not ${ARTIFACTORY_MAVEN_CREDENTIALS})
    type: string
    default: 'ARTIFACTORY_MAVEN_CREDENTIALS'

executor: << parameters.executor >>

steps:
  - checkout
  - install_gcloud
  - maven_auth:
      maven_credentials: << parameters.maven_credentials >>
  - maven_assert_expression:
      expression: 'project.version'
      pattern: '^.*-SNAPSHOT$'
      pom_file: << parameters.pom_file >>
